<div id="report" class="hidden w-full max-w-4xl mx-auto fade-in-up">
            <div class="content-card rounded-xl overflow-hidden border-t-4 border-t-yellow-500 shadow-2xl">
                <div id="severityBar" class="h-1.5 w-full bg-white/5">
                    <div id="severityProgress" class="h-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                
                <div class="p-8 md:p-12">
                    <div id="familyVerdict" class="mb-10 p-6 bg-yellow-500/5 border border-yellow-500/10 rounded-sm hidden shadow-xl">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-yellow-500">✨</span>
                            <p class="text-[9px] font-black uppercase tracking-[0.4em] text-yellow-500">Family Suitability Report</p>
                        </div>
                        <div id="verdictText" class="text-xs text-gray-300 leading-relaxed italic font-light">
                            Analyzing intelligence stream...
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row justify-between items-start border-b border-white/5 pb-8 mb-8 gap-6">
                        <div>
                            <p class="text-yellow-500/50 text-[10px] font-black uppercase tracking-[0.4em] mb-2">Subject Analysis</p>
                            <h2 id="movieTitle" class="text-4xl md:text-5xl font-black text-white uppercase tracking-tighter"></h2>
                        </div>
                        <div id="severityBadge" class="px-6 py-2 border border-white/10 text-[10px] font-black uppercase tracking-widest rounded-full"></div>
                    </div>
                    <div class="space-y-4 w-full" id="detailsList"></div>
                </div>
            </div>
        </div>

<script>
    // ... keep searchMovies() the same ...

    async function analyze(id, title) {
        const category = document.querySelector('input[name="category"]:checked').value;
        const loading = document.getElementById('loading');
        const report = document.getElementById('report');
        const results = document.getElementById('results');
        const verdictBox = document.getElementById('familyVerdict');

        report.classList.add('hidden');
        verdictBox.classList.add('hidden'); // Reset verdict box
        results.classList.add('opacity-10', 'pointer-events-none');
        loading.classList.remove('hidden');

        try {
            const res = await fetch('/analyze', {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({id, category})
            });
            const data = await res.json();
            
            loading.classList.add('hidden');
            results.classList.remove('opacity-10', 'pointer-events-none');
            report.classList.remove('hidden');
            document.getElementById('movieTitle').innerText = title;
            
            // Severity logic...
            const sev = data.severity.toLowerCase();
            const badge = document.getElementById('severityBadge');
            const progress = document.getElementById('severityProgress');
            let color = '#71717a'; let width = '30%';
            if(sev === 'severe') { color = '#ef4444'; width = '100%'; }
            else if(sev === 'moderate') { color = '#f59e0b'; width = '60%'; }
            else if(sev === 'mild') { color = '#3b82f6'; width = '35%'; }
            badge.style.color = color; badge.style.borderColor = color + '44';
            badge.innerText = `SEVERITY: ${sev}`;
            progress.style.backgroundColor = color; progress.style.width = '0%';
            setTimeout(() => progress.style.width = width, 50);

            // Render details...
            const filterSpoilers = document.getElementById('spoilerToggle').checked;
            document.getElementById('detailsList').innerHTML = data.details.map((d) => {
                const isSpoiler = d.includes("[SPOILER]");
                if (isSpoiler && filterSpoilers) {
                    return `<div class="p-6 bg-red-900/10 border-l-2 border-red-500 rounded-sm relative group cursor-pointer spoiler-pulse" onclick="this.querySelector('.txt').classList.remove('blur-md'); this.classList.remove('spoiler-pulse'); this.querySelector('.lbl').remove()"><span class="lbl absolute top-2 right-2 text-[7px] font-black bg-red-500 text-black px-1.5 py-0.5 uppercase tracking-tighter">SPOILER</span><div class="txt text-gray-400 text-xs leading-relaxed blur-md transition-all duration-700">${d.replace("[SPOILER]", "⚠️")}</div></div>`;
                }
                return `<div class="p-6 bg-white/5 border-l border-yellow-500/20 text-gray-400 text-xs leading-relaxed font-light">${d.replace("[SPOILER]", "⚠️")}</div>`;
            }).join('');

            // ADDED: The Gemini Summarization Call
            const summaryRes = await fetch('/summarize', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ details: data.details, title: title })
            });
            const summaryData = await summaryRes.json();
            
            verdictBox.classList.remove('hidden');
            document.getElementById('verdictText').innerText = summaryData.summary;

            window.scrollTo({ top: report.offsetTop - 50, behavior: 'smooth' });

        } catch (e) {
            loading.classList.add('hidden');
            results.classList.remove('opacity-10', 'pointer-events-none');
            alert("Protocol Error.");
        }
    }
</script>