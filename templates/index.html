<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Content Advisor</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-10">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ðŸŽ¬ Movie Content Advisor</h1>
        
        <div class="flex gap-2 mb-4">
            <input id="query" type="text" placeholder="Enter Movie Name..." 
                   class="flex-1 p-3 rounded bg-gray-800 border border-gray-700 focus:border-blue-500 outline-none">
            <button onclick="searchMovies()" class="bg-blue-600 px-6 py-2 rounded font-bold hover:bg-blue-700 transition">Search</button>
        </div>

        <div class="mb-6">
            <label class="block mb-2 font-semibold">Select Category:</label>
            <div class="flex gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="category" value="violence" checked class="w-4 h-4 text-blue-600"> 
                    Violence & Gore
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="radio" name="category" value="nudity" class="w-4 h-4 text-blue-600"> 
                    Sex & Nudity
                </label>
            </div>
        </div>

        <div id="results" class="mt-6 space-y-2"></div>
        
        <div id="report" class="mt-10 p-6 bg-gray-800 rounded-lg border border-gray-700 hidden">
            <h2 id="movieTitle" class="text-2xl font-bold mb-1"></h2>
            <p id="reportCategory" class="text-sm text-gray-400 uppercase tracking-widest mb-2"></p>
            <p id="severity" class="text-xl font-black mb-6"></p>
            <ul id="detailsList" class="space-y-4"></ul>
        </div>
    </div>

    <script>
        async function searchMovies() {
            const query = document.getElementById('query').value;
            if(!query) return;
            
            document.getElementById('results').innerHTML = "Searching...";
            const res = await fetch('/search', {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({query})
            });
            const data = await res.json();
            
            let html = '<h3 class="text-xl mb-3 font-semibold text-blue-400">Search Results:</h3>';
            data.slice(0,5).forEach(m => {
                html += `<button onclick="analyze('${m.id}', '${m.display.replace(/'/g, "\\'")}')" 
                         class="block w-full text-left p-3 bg-gray-700 rounded hover:bg-gray-600 transition mb-2">
                         ${m.display}</button>`;
            });
            document.getElementById('results').innerHTML = html;
        }

        async function analyze(id, title) {
            // Get selected category from radio buttons
            const category = document.querySelector('input[name="category"]:checked').value;
            
            document.getElementById('results').innerHTML = `<div class="p-4 bg-blue-900/30 border border-blue-500 rounded text-blue-300">
                Generating heavy robust report for <b>${category}</b>...</div>`;
            
            const res = await fetch('/analyze', {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({id, category})
            });
            const data = await res.json();
            
            document.getElementById('results').innerHTML = "";
            document.getElementById('report').classList.remove('hidden');
            document.getElementById('movieTitle').innerText = title;
            document.getElementById('reportCategory').innerText = category.replace('_', ' ');
            
            const sev = data.severity.toUpperCase();
            document.getElementById('severity').innerText = "SEVERITY: " + sev;
            
            // Color code the severity
            const sevEl = document.getElementById('severity');
            sevEl.className = "text-xl font-black mb-6 " + 
                (sev === 'SEVERE' ? 'text-red-500' : sev === 'MODERATE' ? 'text-yellow-500' : 'text-green-500');

            document.getElementById('detailsList').innerHTML = data.details.map(d => 
                `<li class="border-l-4 border-gray-600 pl-4 py-2 bg-gray-900/50 rounded-r">${d}</li>`
            ).join('');
        }
    </script>
</body>
</html>
